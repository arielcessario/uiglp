(function(){var a=document.getElementsByTagName("script");var b=a[a.length-1].src;angular.module("uiglp.administracion",["ngRoute",["utils/utils.min.js","ofertas_laborales/ofertas_laborales.min.js","revistas/revistas.min.js","contacto/contacto.min.js","main/main.min.js"]]).config(["$routeProvider",function(d){}]).controller("AdministracionController",c);c.$inject=["LoginService","LoginState","store","$location","OfertasLaboralesService","jwtHelper","$scope","NoticiasService","slidersService","RevistasService","AcUtilsService","AcUtilsGlobals","ContactoService"];function c(l,N,e,E,j,y,q,O,u,H,g,k,C){var s=this;s.usuario={cliente_id:-1,nombre:"",apellido:"",nro_doc:"",telefono:"",password:"",direccion:"",mail:"",rol_id:"0"};s.oferta_laboral={oferta_laboral_id:-1,titulo:"",detalle:"",cliente_id:0};s.noticia={noticia_id:-1,titulo:"",detalles:"",fecha:new Date(),creador_id:0,vistas:0,tipo:"0",fotos:[],comentarios:[]};s.revista={revista_id:-1,nombre:"",link:""};s.usuarios=[];s.ofertas_laborales=[];s.noticias=[];s.revistas=[];s.slider_01={titulo:"",descripcion:"",imagen:"file_add.png",slider_id:1,precio:0,producto_id:0};s.slider_02={titulo:"",descripcion:"",imagen:"file_add.png",slider_id:2,precio:0,producto_id:0};s.slider_03={titulo:"",descripcion:"",imagen:"file_add.png",slider_id:3,precio:0,producto_id:0};s.slider_04={titulo:"",descripcion:"",imagen:"file_add.png",slider_id:4,precio:0,producto_id:0};s.slider_04={titulo:"",descripcion:"",imagen:"file_add.png",slider_id:4,precio:0,producto_id:0};s.slider_05={titulo:"",descripcion:"",imagen:"file_add.png",slider_id:5,precio:0,producto_id:0};s.slider_06={titulo:"",descripcion:"",imagen:"file_add.png",slider_id:6,precio:0,producto_id:0};s.sliders=[];var P={};s.fotoNoticia01={name:"file_add.png"};s.fotoNoticia02={name:"file_add.png"};s.fotoNoticia03={name:"file_add.png"};s.fotoNoticia04={name:"file_add.png"};s.saveUsuario=r;s.removeUsuario=L;s.updateUsuario=n;s.modificarUsuario=z;s.resetUsuario=p;s.saveOfertaLaboral=J;s.modificarOfertaLaboral=I;s.removeOfertaLaboral=A;s.resetOferta=m;s.agregarImagenNoticia=d;s.saveNoticia=D;s.modificarNoticia=K;s.removeNoticia=o;s.resetNoticia=B;s.modificarRevista=G;s.removeRevista=i;s.resetRevista=w;s.saveRevista=x;s.logout=t;s.agregarImagenSlider=v;s.saveSliders=F;s.fotoSlider01={};s.fotoSlider02={};s.fotoSlider03={};s.fotoSlider04={};s.fotoSlider05={};s.fotoSlider06={};s.fotoSlider07={};s.user=y.decodeToken(e.get("jwt"));function t(){N=false;e.remove("jwt");E.path("/ingreso")}if(s.user.data.rol==1){u.getSliders(function(Q){Q[0].precio=0;Q[1].precio=0;Q[2].precio=0;Q[3].precio=0;Q[4].precio=0;Q[5].precio=0;Q[6].precio=0;s.slider_01=Q[0];s.slider_02=Q[1];s.slider_03=Q[2];s.slider_04=Q[3];s.slider_05=Q[4];s.slider_06=Q[5];s.slider_07=Q[6]});O.getNoticias(function(Q){s.noticias=Q});l.getClientes(function(Q){s.usuarios=Q})}else{l.getClienteById(s.user.data.userId,function(Q){s.usuario=Q})}M();function M(){if(s.user.data.rol==1){j.get(function(Q){s.ofertas_laborales=Q})}else{j.getByCliente(s.user.data.userId,function(Q){s.ofertas_laborales=Q})}}h();function h(){H.get(function(Q){s.revistas=Q})}function G(Q){s.revista=angular.copy(Q)}function x(){var R=false;if(s.revista.nombre.trim().length==0){g.validations("revista-nombre","El nombre es obligatorio");R=true}if(s.revista.link.trim().length==0){g.validations("revista-link","El link es obligatorio");R=true}if(R){return}var Q="save";if(s.revista.revista_id!=-1){Q="update"}H.save(Q,s.revista,function(S){console.log(S);H.get(function(T){s.revistas=T;w();h()})})}function w(){s.revista={revista_id:-1,nombre:"",link:""}}function i(){var Q=confirm("Realmente desea borrar la revista?");if(!Q){return}H.remove(s.revista,function(R){w();h()})}function z(R){s.usuario=angular.copy(R);s.usuario.rol_id=""+s.usuario.rol_id;var Q=angular.element(document.querySelector("#nombre"));Q[0].focus()}function p(){s.usuario={cliente_id:-1,nombre:"",apellido:"",nro_doc:"",telefono:"",password:"",direccion:"",mail:"",rol_id:"0"}}function r(){l.create(s.usuario,function(Q){l.getClientes(function(R){s.usuarios=R})})}function L(){var Q=confirm("Realmente desea eliminar el usuario?");if(!Q){return}l.deleteCliente(s.usuario.cliente_id,function(R){l.getClientes(function(S){s.usuarios=S})})}function n(){var Q=false;if(s.usuario.cliente_id==-1){g.validations("nombre","Debe seleccionar un usuario");Q=true;return}if(s.usuario.nombre.trim().length==0){g.validations("nombre","El nombre es obligatorio");Q=true}if(s.usuario.apellido.trim().length==0){g.validations("apellido","El apellido es obligatorio");Q=true}if(s.usuario.nro_doc.trim().length==0){g.validations("cuit","El CUIT es obligatorio");Q=true}if(s.usuario.telefono.trim().length==0){g.validations("telefono","El teléfono es obligatorio");Q=true}if(s.usuario.direccion.trim().length==0){g.validations("direccion","La dirección es obligatoria");Q=true}if(s.usuario.rol_id==undefined){g.validations("rol","Debe asignar un rol");Q=true}if(!g.validateEmail(s.usuario.mail)){g.validations("mail","El mail es incorrecto");Q=true}if(Q){return}l.updateCliente(s.usuario,function(R){l.getClientes(function(S){s.usuarios=S;s.usuario={cliente_id:-1,nombre:"",apellido:"",nro_doc:"",telefono:"",password:"",direccion:"",mail:"",rol_id:"0"}})})}function I(Q){s.oferta_laboral=angular.copy(Q)}function J(){var Q=false;if(s.oferta_laboral.titulo.trim().length==0){g.validations("oferta-titulo","El título es obligatorio");Q=true}if(s.oferta_laboral.detalle.trim().length==0){g.validations("oferta-detalle","La descripción es obligatoria");Q=true}if(Q){return}if(s.oferta_laboral.oferta_laboral_id==-1){s.oferta_laboral.cliente_id=s.user.data.userId;j.create(s.oferta_laboral,function(R){C.sendMail(s.user.data.userName,s.user.data.nombre+" "+s.usuario.apellido,"Nueva Oferta Laboral: "+s.oferta_laboral.detalle,"Se ha creado una nueva oferta laboral",function(S){});m();M()})}else{j.update(s.oferta_laboral,function(R){m();M()})}}function m(){s.oferta_laboral={oferta_laboral_id:-1,titulo:"",detalle:"",cliente_id:0}}function A(){var Q=confirm("Realmente desea eliminar la oferta?");if(!Q){return}j.remove(s.oferta_laboral,function(R){m();M()})}function d(T,Q){for(var S=0;S<T.length;++S){var R=T.item(S);switch(Q){case 1:s.fotoNoticia01={};s.fotoNoticia01=R;f(R);break;case 2:s.fotoNoticia02={};s.fotoNoticia02=R;f(R);break;case 3:s.fotoNoticia03={};s.fotoNoticia03=R;f(R);break;case 4:s.fotoNoticia04={};s.fotoNoticia04=R;f(R);break}P={};P.foto=R.name;P.main=1}}function f(R,Q){var T=new FormData();if(R.size>400000){alert("No se puede subir un archivo que sea mayor a 400k");return}T.append("images",R);var S=new XMLHttpRequest();S.onprogress=function(){};S.onload=function(U){q.$apply()};S.open("POST","bower_components/ac-angular-noticias/upload.php");S.send(T)}function D(){var Q=false;if(s.fotoNoticia01.name=="file_add.png"&&s.fotoNoticia02.name=="file_add.png"&&s.fotoNoticia03.name=="file_add.png"&&s.fotoNoticia04.name=="file_add.png"){g.validations("noticia-foto","Al menos debe subir una foto");Q=true}if(s.noticia.titulo.trim().length==0){g.validations("noticia-titulo","El título es obligatorio");Q=true}if(s.noticia.detalles.trim().length==0){g.validations("noticia-detalles","La descripción es obligatoria");Q=true}if(s.noticia.fecha==undefined){g.validations("noticia-fecha","La fecha no es válida");Q=true}if(Q){return}s.noticia.fotos=[];if(s.fotoNoticia01.name!==undefined){P={};P.foto=s.fotoNoticia01.name;P.main=1;s.noticia.fotos.push(P)}if(s.fotoNoticia02.name!==undefined){P={};P.foto=s.fotoNoticia02.name;P.main=0;s.noticia.fotos.push(P)}if(s.fotoNoticia03.name!==undefined){P={};P.foto=s.fotoNoticia03.name;P.main=0;s.noticia.fotos.push(P)}if(s.fotoNoticia04.name!==undefined){P={};P.foto=s.fotoNoticia04.name;P.main=0;s.noticia.fotos.push(P)}s.noticia.fecha=new Date((s.noticia.fecha.getMonth()+1)+"/"+(s.noticia.fecha.getDate()+1)+"/"+s.noticia.fecha.getFullYear());if(s.noticia.noticia_id==-1){O.save(s.noticia,"saveNoticia",function(R){B();O.getNoticias(function(S){s.noticias=S})})}else{O.save(s.noticia,"updateNoticia",function(R){B();O.getNoticias(function(S){s.noticias=S})})}}function K(Q){s.noticia=angular.copy(Q);s.noticia.tipo=""+s.noticia.tipo;s.fotoNoticia01.name=(s.noticia.fotos[0]!==undefined)?s.noticia.fotos[0].foto:undefined;s.fotoNoticia02.name=(s.noticia.fotos[1]!==undefined)?s.noticia.fotos[1].foto:undefined;s.fotoNoticia03.name=(s.noticia.fotos[2]!==undefined)?s.noticia.fotos[2].foto:undefined;s.fotoNoticia04.name=(s.noticia.fotos[3]!==undefined)?s.noticia.fotos[3].foto:undefined;k.broadcast()}function o(){var Q=confirm("Realmente desea eliminar la noticia?");if(!Q){return}O.deleteNoticia(s.noticia.noticia_id,function(R){B();O.getNoticias(function(S){s.noticias=S})})}function B(){s.noticia={noticia_id:-1,titulo:"",detalles:"",fecha:new Date(),creador_id:0,vistas:0,tipo:"0",fotos:[],comentarios:[]};var Q={};s.fotoNoticia01={};s.fotoNoticia02={};s.fotoNoticia03={};s.fotoNoticia04={};s.fotoNoticia01.name="file_add.png";s.fotoNoticia02.name="file_add.png";s.fotoNoticia03.name="file_add.png";s.fotoNoticia04.name="file_add.png"}function F(){var Q=false;if(Q){return}if(s.fotoSlider01.name!==undefined){s.slider_01.imagen=s.fotoSlider01.name}if(s.fotoSlider02.name!==undefined){s.slider_02.imagen=s.fotoSlider02.name}if(s.fotoSlider03.name!==undefined){s.slider_03.imagen=s.fotoSlider03.name}if(s.fotoSlider04.name!==undefined){s.slider_04.imagen=s.fotoSlider04.name}if(s.fotoSlider05.name!==undefined){s.slider_05.imagen=s.fotoSlider05.name}if(s.fotoSlider06.name!==undefined){s.slider_06.imagen=s.fotoSlider06.name}if(s.fotoSlider07.name!==undefined){s.slider_07.imagen=s.fotoSlider07.name}s.slider_01.producto_id=-1;s.slider_02.producto_id=-1;s.slider_03.producto_id=-1;s.slider_04.producto_id=-1;s.slider_05.producto_id=-1;s.slider_06.producto_id=-1;s.slider_07.producto_id=-1;s.sliders.push(s.slider_01);s.sliders.push(s.slider_02);s.sliders.push(s.slider_03);s.sliders.push(s.slider_04);s.sliders.push(s.slider_05);s.sliders.push(s.slider_06);s.sliders.push(s.slider_07);u.saveSlider(s.sliders,"saveSlider",function(R){console.log(R)})}function v(T,Q){for(var S=0;S<T.length;++S){var R=T.item(S);switch(Q){case 1:s.fotoSlider01={};s.fotoSlider01=R;s.slider_01.imagen=s.fotoSlider01.name;f(R);break;case 2:s.fotoSlider02={};s.fotoSlider02=R;s.slider_02.imagen=s.fotoSlider02.name;f(R);break;case 3:s.fotoSlider03={};s.fotoSlider03=R;s.slider_03.imagen=s.fotoSlider03.name;f(R);break;case 4:s.fotoSlider04={};s.fotoSlider04=R;s.slider_04.imagen=s.fotoSlider04.name;f(R);break;case 5:s.fotoSlider05={};s.fotoSlider05=R;s.slider_05.imagen=s.fotoSlider05.name;f(R);break;case 6:s.fotoSlider06={};s.fotoSlider06=R;s.slider_06.imagen=s.fotoSlider06.name;f(R);break;case 7:s.fotoSlider07={};s.fotoSlider07=R;s.slider_07.imagen=s.fotoSlider07.name;f(R);break}}}}})();